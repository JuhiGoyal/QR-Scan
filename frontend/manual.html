<!DOCTYPE html>
<html>
<head>
  <title>Manual Verification</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
  <h1>Manual Verification</h1>

  <div class="card">
    <input id="code" placeholder="Enter Manual Code">

    <select id="action">
      <option value="gate">Gate</option>
      <option value="washroom">Washroom</option>
    </select>

    <button type="button" onclick="submitNow()">Submit</button>

    <div id="result" style="margin-top:15px; font-size:18px;"></div>
  </div>
</div>

<script>
  // üëâ CHANGE THIS FOR DEPLOYMENT
  // const API_BASE = "http://localhost:3000";
  const API_BASE = "https://qr-backend-5qot.onrender.com";

  const result = document.getElementById("result");

  function safe(v) {
    return (v === undefined || v === null || v === "") ? "-" : v;
  }

  function submitNow() {
    const manualCode = document.getElementById("code").value.trim();
    const action = document.getElementById("action").value;

    if (!manualCode) {
      alert("Manual code required");
      return;
    }

    result.innerHTML = `<b>‚è≥ Checking...</b>`;

    fetch(`${API_BASE}/manual?code=${manualCode}&action=${action}`)
      .then(r => r.json())
      .then(res => {
        if (!res.success) {
          result.innerHTML = `<h2 style="color:red;">${safe(res.message)} ‚ùå</h2>`;
          return;
        }

        result.innerHTML = `
          <h2 style="color:green;">${action === "gate" ? "Gate" : "Washroom"} Updated ‚úî</h2>

          <b>Name:</b> ${safe(res.name)}<br>
          <b>Phone:</b> ${safe(res.phone)}<br>
          <b>Manual Code:</b> ${safe(res.manualCode)}<br>

          <br>

          <!-- ‚úÖ Optional fields (future-proof) -->
          <b>Address:</b> ${safe(res.address)}<br>
          <b>Car Voucher No:</b> ${safe(res.carVoucherNumber)}<br>
          <b>Car Number:</b> ${safe(res.carNumber)}<br>
          <b>Zone:</b> ${res.zone ? res.zone : "<span style='color:gray;'>Not Set</span>"}<br>

          <br>

          <b>Gate:</b>
          <span style="color:${res.gateStatus === "IN" ? "green" : "red"}">${safe(res.gateStatus)}</span><br>

          <b>Washroom:</b>
          <span style="color:${res.washroomStatus === "IN" ? "blue" : "gray"}">${safe(res.washroomStatus)}</span><br><br>

          <small>Updated just now</small>
        `;
      })
      .catch(() => {
        result.innerHTML = `<h2 style="color:red;">Request Failed ‚ùå</h2>`;
      });
  }
</script>

</body>
</html>
